# –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Selenium

## –û–ø–∏—Å–∞–Ω–∏–µ

–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞–±–ª—é–¥–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä Chrome. –¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –±—Ä–∞—É–∑–µ—Ä, –ø—Ä–æ–∫–ª–∏–∫–∏–≤–∞—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∑–∞–ø–æ–ª–Ω—è—é—Ç —Ñ–æ—Ä–º—ã –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ù–∞ —Ö–æ—Å—Ç–µ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞):

1. **Chrome/Chromium –±—Ä–∞—É–∑–µ—Ä**
   ```bash
   sudo apt-get install chromium-browser
   # –∏–ª–∏
   sudo apt-get install google-chrome-stable
   ```

2. **ChromeDriver**
   ```bash
   sudo apt-get install chromium-chromedriver
   # –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é —Å https://chromedriver.chromium.org/
   ```

3. **X Server** (–æ–±—ã—á–Ω–æ —É–∂–µ –∑–∞–ø—É—â–µ–Ω)
   ```bash
   echo $DISPLAY  # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å :0 –∏–ª–∏ :99
   ```

4. **Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   ```bash
   pip install -r requirements-dev.txt
   ```

## –ó–∞–ø—É—Å–∫ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ:
   ```bash
   docker-compose up -d web
   ```

2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
   ```
   http://localhost:8000/secret-test/?key=test-secret-2024
   ```

3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **üëÅÔ∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (Selenium)**

4. –ë—Ä–∞—É–∑–µ—Ä Chrome –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –Ω–∞–±–ª—é–¥–∞—Ç—å:
   - –ó–∞–≥—Ä—É–∑–∫—É –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –í—ã–±–æ—Ä –∏ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤
   - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º
   - –ù–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
   - –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
./scripts/run_visual_tests_local.sh
```

### –°–ø–æ—Å–æ–± 3: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ pytest

```bash
pytest transcribe/tests/test_visual_scenarios.py -v -m visual -s
```

## –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞** - –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã, –æ—Ç–ø—Ä–∞–≤–∫–∞
2. **–í—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é** - –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
3. **–ù–∞–≤–∏–≥–∞—Ü–∏—è** - –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏, –∫–ª–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º
4. **–í—ã–±–æ—Ä –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Ñ–∞–π–ª–æ–≤

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è

–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–ë–ï–ó headless —Ä–µ–∂–∏–º–∞**, –ø–æ—ç—Ç–æ–º—É –±—Ä–∞—É–∑–µ—Ä –±—É–¥–µ—Ç –≤–∏–¥–µ–Ω. 

–î–ª—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—á—Ç–æ–±—ã –ª—É—á—à–µ –≤–∏–¥–µ—Ç—å –ø—Ä–æ—Ü–µ—Å—Å):
```python
time.sleep(2)  # –ü–∞—É–∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏
```

## –°–∫—Ä–∏–Ω—à–æ—Ç—ã

–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞—é—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/tmp/screenshot_*.png`).

## –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DISPLAY:
   ```bash
   echo $DISPLAY
   export DISPLAY=:0  # –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ChromeDriver:
   ```bash
   chromedriver --version
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞:
   ```bash
   xhost +local:  # –†–∞–∑—Ä–µ—à–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ X server
   ```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ X server –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
   ```bash
   Xvfb :99 -screen 0 1920x1080x24 &
   export DISPLAY=:99
   ```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ë—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–∏–º—ã–º (–Ω–µ headless)
- –¢–µ—Å—Ç—ã –º–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑-–∑–∞ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–∞—É–∑
- –î–ª—è CI/CD –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö


